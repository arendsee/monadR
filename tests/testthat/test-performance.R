context("performance and scale")

u <- function(x) { x + 1 }

test_that('rmonad will handle 100 nodes in less than a second', {
  expect_true(
    system.time(
      m <- 1 %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u
    )[1] < 1
  )
})

test_that('rmonad will handle very large systems', {
  expect_equal(
      1 %>>%

      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>%
      u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>>% u %>% esc,
    1001
  )
})
