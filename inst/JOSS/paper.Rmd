---
title: "rmonad: Pipelines with history"
authors:
- affiliation: 1
  name: Zebulun Arendsee 
  orcid: 0000-0002-5833-798X
- affiliation: 2
  name: Jennifer Chang
  orcid: 0000-0002-8381-3765
- affiliation: 1
  name: Eve Wurtele
  orcid: XXXX-XXXX-XXXX-XXXX
date: "`r Sys.Date()`"
output:
  html_document:
    keep_md: yes
bibliography: paper.bib
tags:
- R
- pipeline
affiliations:
  - index: 1
    name: Iowa State University, Department of Genetics Development and Cell Biology
  - index: 2
    name: XXXXX
---

# Introduction

`rmonad` is designed to reduce the tedium of pipeline development and maintainance.

Data scientists usually spend the majority of their time getting, cleaning and
organizing data [@crowdflower2017]. 

The `rmonad` package provides a set of tools to chain monadic sequences into
stateful, branching pipelines. As nodes in the pipeline are run, they are
merged into a graph of all past operations. The resulting structure can be
computed on to access not only the final results, but also node documentation,
intermediate data, performance stats, and any raised messages, warnings or
errors. `rmonad` intercepts all exceptions, which allows for pure error
handling.


# Why we need a monadic pipeline program in R

The concept of pipeline-based programming is well-accepted in the R community,
mostly through the `magrittr` package. `magrittr` provides piping functionality
in R. rmonad enhances the `magrittr` functionality by X, Y, z.

When building pipelines, especially flexible and scalable pipelines, the main
challenge is to maintain clarity in design and maintenance. A pipeline tool
that keeps track of branching provides standard ways to think of pipelines and
more efficient pipeline design. 


# Approach

(add a figure, showing the container-based rmonad approach. the figure is
really important, this stuff is a pain to explain, but much easier to draw.
I'll get a figure together soon ...)

`rmonad` is inspired from-Haskell style monads (see fig), but formal rigor has
been sacrificed for convenience. It should be considered more, monadish, than
monadic.


# Features

(how to present the features? a table? a list of subsections? a run-on sentence?)

 * branching (many simple pipeline programs are linear)

 * conditionals and error recovery

 * caching

 * documentation

 * error, warning, message capture

 * code capture

 * benchmarking

 * traceback with stored inputs

 * post-processing functions: summarize

 * report generation

 * metadata

A conspicuosly absent feature is automatic parallelism and cluster submission
handling. These may be added in the future, but currently the goal of `rmonad`
is to handle complexity, not volume.

# Approach

 | operator | description                                                                     |
 | -------- | ------------------------------------------------------------------------------- |
 | `%>>%`   | pass left hand side (lhs) as initial argument of right hand side (rhs) function |
 | `%v>%`   | like `%>>%` but stores lhs value                                                |
 | `%>_%`   | like `%>>%` but passes lhs instead of rhs -- propagates rhs failure             |
 | `%>^%`   | like `%>_%` but does not propagate rhs failure, branch operator                 |
 | `%||%`   | use rhs value if lhs is failing                                                 |
 | `%|>%`   | call rhs on lhs if lhs failed                                                   |
 | `%*>%`   | treat lhs as list of arguments passed to the rhs function                       |
 | `%__%`   | ignore lhs, rhs starts a new chain (but preserves lhs history)                  |



![plot of a big pipeline](big-pipelines.png)
    Include graph of pipelines here. Include description for why a node is green or
    orange. Make sure this graph is color-blind safe. Point out some errors that
    are caught by this graph. Point out some design decisions to make the pipeline
    more efficient inspired by looking at the graph. Spell out why this graph is
    important.

# Conclusions

We have presented a method to incorporate monadic pipelines into R using the
rmonad tool. This paper was motivated by the desire to publish best practices
in pipelines in R and to encourage better pipeline design and maintenance. 

# References
